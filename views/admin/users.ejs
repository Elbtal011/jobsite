<%- include('../partials/head', { title: 'Users | Admin' }) %>
<main class="admin-dashboard">
  <aside class="admin-sidebar">
    <div>
      <h2 class="admin-brand">Admin Bereich</h2>
      <p class="admin-subtitle">Verwaltung und Pipeline</p>
      <nav class="admin-nav">
        <a class="admin-nav-item" href="/admin666/leads">Alle Leads</a>
        <a class="admin-nav-item" href="/admin666/leads/application">Bewerbung Leads</a>
        <a class="admin-nav-item" href="/admin666/leads/contact">Kontakt Leads</a>
        <a class="admin-nav-item" href="/admin666/chats">Chats</a>
        <a class="admin-nav-item active" href="/admin666/users">Users</a>
        <a class="admin-nav-item" href="/admin666/jobs">Stellen</a>
      </nav>
    </div>

    <form method="post" action="/admin666/logout">
      <input type="hidden" name="_csrf" value="<%= csrfToken %>" />
      <button class="btn btn-secondary admin-logout" type="submit">Logout</button>
    </form>
  </aside>

  <section class="page-shell admin-content">
    <div class="admin-top">
      <h1>Users</h1>
    </div>
    <% if (query && query.deleted === '1') { %>
      <p class="alert success">Ausgewählte Nutzer wurden gelöscht.</p>
    <% } %>

    <form class="filter-grid" method="get" action="/admin666/users">
      <input name="q" placeholder="Suche Name/E-Mail/Telefon" value="<%= filters.q %>" />
      <select name="status">
        <option value="">Alle Status</option>
        <option value="active" <%= filters.status === 'active' ? 'selected' : '' %>>Aktiv</option>
        <option value="inactive" <%= filters.status === 'inactive' ? 'selected' : '' %>>Inaktiv</option>
      </select>
      <button class="btn btn-primary" type="submit">Filtern</button>
    </form>

    <form method="post" action="/admin666/users/delete-selected" onsubmit="return confirm('Ausgewählte Nutzer wirklich löschen?')">
      <input type="hidden" name="_csrf" value="<%= csrfToken %>" />
      <div class="admin-actions" style="margin-bottom:8px;">
        <button class="btn btn-secondary" type="submit">Auswahl löschen</button>
      </div>
      <div class="table-wrap">
        <table>
          <thead>
            <tr>
              <th><input id="users-select-all" type="checkbox" /></th>
              <th>Name</th>
              <th>E-Mail</th>
              <th>Telefon</th>
              <th>Dokumente</th>
              <th>Status</th>
              <th>Erstellt</th>
              <th></th>
            </tr>
          </thead>
          <tbody>
            <% users.forEach((u) => { %>
              <tr>
                <td><input class="user-select-item" type="checkbox" name="ids" value="<%= u.id %>" /></td>
                <td><%= [u.first_name, u.last_name].filter(Boolean).join(' ') %></td>
                <td><%= u.email %></td>
                <td><%= u.phone || '-' %></td>
                <td><%= Number(u.doc_count || 0) %></td>
                <td><span class="status status-<%= u.is_active ? 'closed' : 'in_review' %>"><%= u.is_active ? 'active' : 'inactive' %></span></td>
                <td><%= new Date(u.created_at).toLocaleString('de-DE') %></td>
                <td><a class="admin-link" href="/admin666/users/<%= u.id %>">Details</a></td>
              </tr>
            <% }) %>
          </tbody>
        </table>
      </div>
    </form>
  </section>
</main>
<script>
  (function() {
    const selectAll = document.getElementById('users-select-all');
    if (!selectAll) return;
    selectAll.addEventListener('change', function() {
      document.querySelectorAll('.user-select-item').forEach((cb) => {
        cb.checked = selectAll.checked;
      });
    });
  })();
</script>
</body>
</html>

